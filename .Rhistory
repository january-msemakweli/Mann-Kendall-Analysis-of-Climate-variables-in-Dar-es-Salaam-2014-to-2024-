)
ggplot(df_panel, aes(x = date)) +
geom_point(aes(y = value)) +
geom_line(aes(y = sen_line), linewidth = 1) +
facet_grid(Variable ~ Season, scales = "free_y") +
labs(
title = "",
x = "Year",
y = "Value"
)
ggplot(df_panel, aes(x = date)) +
geom_point(aes(y = value)) +
geom_line(aes(y = sen_line), linewidth = 1) +
facet_grid(Variable ~ Season, scales = "free_y") +
labs(
title = "",
x = "Year",
y = "Value"
)
ggplot(df_panel, aes(x = date)) +
geom_point(aes(y = value)) +
geom_line(aes(y = sen_line), linewidth = 1) +
facet_grid(Variable ~ Season, scales = "free_y") +
labs(
x = "Year",
y = "Value"
)
knitr::opts_chunk$set(echo = TRUE)
# ============================================================
# LOAD REQUIRED LIBRARIES
# ============================================================
# This section loads all necessary R packages for data manipulation,
# statistical analysis, and visualization. Each package serves a specific
# purpose in the analysis pipeline.
library(readr)        # Efficient reading of CSV files
library(dplyr)        # Data manipulation and filtering operations
library(Kendall)      # Mann-Kendall test implementation: MannKendall()
library(trend)        # Sen's slope estimator: sens.slope()
library(knitr)        # Dynamic report generation
library(kableExtra)   # Enhanced table formatting for publication
library(ggplot2)      # Data visualization and plotting
library(tidyr)        # Data reshaping (pivot_longer for long format)
# ============================================================
# 1. DATA LOADING AND PREPROCESSING
# ============================================================
# Load the climatic dataset from CSV file. The dataset contains monthly
# observations of climatic variables for Dar es Salaam, Tanzania.
# Expected columns: Year, Month, Season, and climatic variables.
df <- read_csv("CLIMATE DAR DATASET.csv")
# Create a standardized date column from Year and Month variables.
# This conversion is essential for proper time series analysis and ensures
# chronological ordering of observations. The date is set to the first day
# of each month to standardize temporal representation.
df$date <- as.Date(paste(df$Year, df$Month, "01", sep = "-"), format="%Y-%b-%d")
# ============================================================
# 2. VARIABLE DEFINITION AND LABELING
# ============================================================
# Define the climatic variables to be analyzed. These variables represent
# key indicators of climate change: precipitation, temperature extremes,
# and atmospheric moisture. Each variable will be tested for trends
# separately within each season to capture seasonal patterns.
vars <- c("rainfall_mm",
"daytime_temperature_celcius",
"nighttime_temperature_celcius",
"relative_humidity_%")
# Create human-readable labels for presentation in tables and figures.
# These labels will be used in all output to ensure clarity for readers.
var_labels <- c("Rainfall (mm)",
"Daytime Temperature (°C)",
"Nighttime Temperature (°C)",
"Relative Humidity (%)")
# ============================================================
# 3. MANN-KENDALL TEST AND SEN'S SLOPE FUNCTION
# ============================================================
# This function implements the complete trend analysis workflow:
# (1) Mann-Kendall test for trend detection
# (2) Sen's slope estimator for trend magnitude
# (3) Z-statistic calculation for standardized test interpretation
#
# The Mann-Kendall test evaluates the null hypothesis that there is no
# monotonic trend in the time series. The test statistic S measures the
# direction and strength of the trend, while the Z-statistic provides a
# standardized measure for hypothesis testing.
#
# Sen's slope estimator is a robust non-parametric method that estimates
# the median slope of all pairwise combinations, making it resistant to
# outliers and appropriate for climatic data.
run_mk <- function(x) {
# Perform Mann-Kendall test on the time series x
# Returns: S (test statistic), varS (variance of S), and sl (p-value)
mk <- MannKendall(x)
# Calculate Sen's slope estimator
# This provides the median rate of change per unit time
sen <- sens.slope(x)$estimates
# Extract components needed for Z-statistic calculation
# The Z-statistic is computed from S and its variance to enable
# standardized interpretation of the test results
n <- length(x)
S <- mk$S          # Mann-Kendall test statistic
varS <- mk$varS    # Variance of the test statistic
# Calculate Z-statistic following standard Mann-Kendall procedure
# Z > 0 indicates increasing trend, Z < 0 indicates decreasing trend
# The continuity correction (±1) is applied to improve normal approximation
if (varS > 0) {
if (S > 0) {
Z <- (S - 1) / sqrt(varS)      # Positive trend correction
} else if (S == 0) {
Z <- 0                          # No trend
} else {
Z <- (S + 1) / sqrt(varS)      # Negative trend correction
}
} else {
Z <- 0  # Handle edge case where variance is zero or invalid
}
# Return all relevant statistics for interpretation
return(list(Z = Z, p = mk$sl, slope = sen))
}
# ============================================================
# 4. SEASONAL TREND ANALYSIS
# ============================================================
# This section performs the Mann-Kendall test for each combination of
# season and climatic variable. The analysis is stratified by season
# to identify seasonal-specific trends, which is crucial for understanding
# climate change impacts that may vary throughout the year.
#
# The loop structure ensures comprehensive coverage of all season-variable
# combinations, allowing for systematic detection of trends across the
# entire dataset.
results <- data.frame()
# Iterate through each unique season in the dataset
for (s in unique(df$Season)) {
# Filter data for the current season and sort chronologically
# Chronological ordering is required for proper time series analysis
sub_data <- df %>% filter(Season == s) %>% arrange(date)
# Analyze each climatic variable within the current season
for (i in seq_along(vars)) {
v <- vars[i]                    # Variable name in dataset
label <- var_labels[i]          # Human-readable label
x <- sub_data[[v]]              # Extract time series values
# Apply trend test only if sufficient data points are available
# Minimum of 8 observations is required for meaningful statistical
# inference in non-parametric tests (Mann-Kendall minimum sample size)
if (length(x) >= 8) {
mkout <- run_mk(x)
# Store results in a structured data frame
# Results include: season, variable name, Z-score, p-value, and Sen's slope
results <- rbind(results, data.frame(
Season = s,
Variable = label,
Z = round(mkout$Z, 4),           # Z-statistic (rounded to 4 decimals)
p_value = round(mkout$p, 5),     # P-value (rounded to 5 decimals)
Sen_slope = round(mkout$slope, 5) # Sen's slope (rounded to 5 decimals)
))
}
}
}
# ============================================================
# 5. RESULTS PRESENTATION
# ============================================================
# Generate a publication-ready table summarizing all Mann-Kendall test results.
# The table presents:
# - Z-score: Standardized test statistic (|Z| > 1.96 indicates significance at α=0.05)
# - P-value: Probability of observing the trend under the null hypothesis
# - Sen's slope: Estimated rate of change per unit time (e.g., mm/year, °C/year)
#
# Interpretation guidelines:
# - p-value < 0.05: Statistically significant trend detected
# - Positive Sen's slope: Increasing trend over time
# - Negative Sen's slope: Decreasing trend over time
results %>%
kable(
format = "html",
caption = "Mann–Kendall Trend Test Results for Seasonal Climatic Variables (2014–2024)",
col.names = c("Season", "Variable", "Z-Score", "p-value", "Sen's slope"),
digits = 5
) %>%
kable_styling(full_width = FALSE, bootstrap_options = c("striped", "hover"))
df_long <- df %>%
select(
date, Season,
rainfall_mm,
daytime_temperature_celcius,
nighttime_temperature_celcius,
`relative_humidity_%`
) %>%
pivot_longer(
cols = c(
rainfall_mm,
daytime_temperature_celcius,
nighttime_temperature_celcius,
`relative_humidity_%`
),
names_to = "var",
values_to = "value"
) %>%
mutate(
Variable = dplyr::recode(
var,
"rainfall_mm"                   = "Rainfall (mm)",
"daytime_temperature_celcius"   = "Daytime Temperature (°C)",
"nighttime_temperature_celcius" = "Nighttime Temperature (°C)",
"relative_humidity_%"           = "Relative Humidity (%)"
)
)
sig_results <- results %>%
filter(p_value < 0.05) %>%
select(Season, Variable) %>%
distinct()
df_long_sig <- df_long %>%
inner_join(sig_results, by = c("Season", "Variable"))
df_panel <- df_long_sig %>%
group_by(Season, Variable) %>%
arrange(date, .by_group = TRUE) %>%
mutate(t = row_number()) %>%
group_modify(~ {
sen <- sens.slope(.x$value)$estimates
intercept <- median(.x$value - sen * .x$t, na.rm = TRUE)
.x %>%
mutate(
sen_slope = sen,
intercept = intercept,
sen_line  = intercept + sen * t
)
}) %>%
ungroup()
ggplot(df_panel, aes(x = date)) +
geom_point(aes(y = value)) +
geom_line(aes(y = sen_line), linewidth = 1) +
facet_grid(Variable ~ Season, scales = "free_y") +
labs(
x = "Year",
y = "Value"
)
# Prepare data with Sen's slope lines for all season-variable combinations
df_all_panel <- df_long %>%
group_by(Season, Variable) %>%
arrange(date, .by_group = TRUE) %>%
mutate(t = row_number()) %>%
group_modify(~ {
if (length(.x$value) >= 8) {
sen <- sens.slope(.x$value)$estimates
intercept <- median(.x$value - sen * .x$t, na.rm = TRUE)
.x %>%
mutate(
sen_slope = sen,
intercept = intercept,
sen_line  = intercept + sen * t
)
} else {
.x %>%
mutate(
sen_slope = NA,
intercept = NA,
sen_line  = NA
)
}
}) %>%
ungroup() %>%
left_join(results, by = c("Season", "Variable")) %>%
mutate(
Significance = if_else(p_value < 0.05, "Significant (p < 0.05)", "Not Significant")
)
# Create comprehensive time series plot
ggplot(df_all_panel, aes(x = date, y = value)) +
geom_point(aes(color = Significance), alpha = 0.6, size = 1) +
geom_line(aes(y = sen_line, linetype = Significance), linewidth = 1.2, na.rm = TRUE) +
scale_color_manual(values = c("Significant (p < 0.05)" = "#d62728",
"Not Significant" = "#636363")) +
scale_linetype_manual(values = c("Significant (p < 0.05)" = "solid",
"Not Significant" = "dashed")) +
facet_grid(Variable ~ Season, scales = "free_y") +
labs(
x = "Year",
y = "Value",
color = "Trend Significance",
linetype = "Trend Significance",
title = "Time Series of Climatic Variables by Season (2014-2024)",
subtitle = "Solid lines indicate statistically significant trends (p < 0.05); dashed lines indicate non-significant trends"
) +
theme_minimal() +
theme(
plot.title = element_text(size = 14, face = "bold"),
plot.subtitle = element_text(size = 11),
strip.text = element_text(size = 10),
legend.position = "bottom"
)
ggplot(df_long, aes(x = Season, y = value, fill = Season)) +
geom_boxplot(alpha = 0.7, outlier.alpha = 0.5) +
facet_wrap(~ Variable, scales = "free_y", ncol = 2) +
labs(
x = "Season",
y = "Value",
title = "Seasonal Distribution of Climatic Variables (2014-2024)",
subtitle = "Box plots show median (thick line), quartiles (box), and outliers (points)"
) +
theme_minimal() +
theme(
plot.title = element_text(size = 14, face = "bold"),
plot.subtitle = element_text(size = 11),
strip.text = element_text(size = 10),
legend.position = "none",
axis.text.x = element_text(angle = 45, hjust = 1)
) +
scale_fill_brewer(palette = "Set2")
# Add significance indicator to results
results_viz <- results %>%
mutate(
Significance = if_else(p_value < 0.05, "Significant", "Not Significant"),
Trend_Direction = if_else(Sen_slope > 0, "Increasing", "Decreasing")
)
ggplot(results_viz, aes(x = reorder(paste(Season, Variable, sep = " - "), Sen_slope),
y = Sen_slope,
fill = Significance)) +
geom_bar(stat = "identity", alpha = 0.8) +
geom_hline(yintercept = 0, linetype = "dashed", color = "black", linewidth = 0.5) +
coord_flip() +
scale_fill_manual(values = c("Significant" = "#d62728",
"Not Significant" = "#95a5a6")) +
labs(
x = "Season - Variable",
y = "Sen's Slope (units/year)",
fill = "Statistical Significance",
title = "Magnitude and Direction of Trends by Season and Variable",
subtitle = "Positive values indicate increasing trends; negative values indicate decreasing trends"
) +
theme_minimal() +
theme(
plot.title = element_text(size = 14, face = "bold"),
plot.subtitle = element_text(size = 11),
axis.text.y = element_text(size = 8),
legend.position = "bottom"
)
# Create a matrix for heatmap
results_heatmap <- results %>%
mutate(
Significance_Level = case_when(
p_value < 0.001 ~ "< 0.001",
p_value < 0.01 ~ "0.001 - 0.01",
p_value < 0.05 ~ "0.01 - 0.05",
p_value < 0.1 ~ "0.05 - 0.1",
TRUE ~ "≥ 0.1"
)
) %>%
mutate(Significance_Level = factor(Significance_Level,
levels = c("< 0.001", "0.001 - 0.01",
"0.01 - 0.05", "0.05 - 0.1", "≥ 0.1")))
ggplot(results_heatmap, aes(x = Season, y = Variable, fill = Significance_Level)) +
geom_tile(color = "white", linewidth = 0.5) +
geom_text(aes(label = round(p_value, 3)), size = 3, color = "white", fontface = "bold") +
scale_fill_manual(values = c("< 0.001" = "#67001f",
"0.001 - 0.01" = "#b2182b",
"0.01 - 0.05" = "#d6604d",
"0.05 - 0.1" = "#f4a582",
"≥ 0.1" = "#f7f7f7")) +
labs(
x = "Season",
y = "Variable",
fill = "P-value Range",
title = "Statistical Significance of Trends Across Seasons and Variables",
subtitle = "Darker colors indicate more significant trends (lower p-values)"
) +
theme_minimal() +
theme(
plot.title = element_text(size = 14, face = "bold"),
plot.subtitle = element_text(size = 11),
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "right"
)
# Calculate annual averages
df_annual <- df %>%
group_by(Year, Season) %>%
summarise(
Rainfall = mean(rainfall_mm, na.rm = TRUE),
Daytime_Temp = mean(daytime_temperature_celcius, na.rm = TRUE),
Nighttime_Temp = mean(nighttime_temperature_celcius, na.rm = TRUE),
Humidity = mean(`relative_humidity_%`, na.rm = TRUE),
.groups = "drop"
) %>%
pivot_longer(
cols = c(Rainfall, Daytime_Temp, Nighttime_Temp, Humidity),
names_to = "Variable",
values_to = "Annual_Mean"
) %>%
mutate(
Variable = case_when(
Variable == "Rainfall" ~ "Rainfall (mm)",
Variable == "Daytime_Temp" ~ "Daytime Temperature (°C)",
Variable == "Nighttime_Temp" ~ "Nighttime Temperature (°C)",
Variable == "Humidity" ~ "Relative Humidity (%)"
)
)
ggplot(df_annual, aes(x = Year, y = Annual_Mean, color = Season)) +
geom_point(size = 2.5, alpha = 0.7) +
geom_line(linewidth = 1, alpha = 0.6) +
geom_smooth(method = "lm", se = TRUE, linetype = "dashed", linewidth = 1, alpha = 0.3) +
facet_wrap(~ Variable, scales = "free_y", ncol = 2) +
labs(
x = "Year",
y = "Annual Mean Value",
color = "Season",
title = "Annual Trends in Climatic Variables by Season (2014-2024)",
subtitle = "Dashed lines show linear trend fits with 95% confidence intervals"
) +
theme_minimal() +
theme(
plot.title = element_text(size = 14, face = "bold"),
plot.subtitle = element_text(size = 11),
strip.text = element_text(size = 10),
legend.position = "bottom"
) +
scale_color_brewer(palette = "Set2")
# Extract month number from date
df_monthly <- df %>%
mutate(Month_Num = as.numeric(format(date, "%m"))) %>%
group_by(Month_Num, Season) %>%
summarise(
Rainfall = mean(rainfall_mm, na.rm = TRUE),
Daytime_Temp = mean(daytime_temperature_celcius, na.rm = TRUE),
Nighttime_Temp = mean(nighttime_temperature_celcius, na.rm = TRUE),
Humidity = mean(`relative_humidity_%`, na.rm = TRUE),
.groups = "drop"
) %>%
pivot_longer(
cols = c(Rainfall, Daytime_Temp, Nighttime_Temp, Humidity),
names_to = "Variable",
values_to = "Monthly_Mean"
) %>%
mutate(
Variable = case_when(
Variable == "Rainfall" ~ "Rainfall (mm)",
Variable == "Daytime_Temp" ~ "Daytime Temperature (°C)",
Variable == "Nighttime_Temp" ~ "Nighttime Temperature (°C)",
Variable == "Humidity" ~ "Relative Humidity (%)"
),
Month_Name = month.abb[Month_Num]
) %>%
mutate(Month_Name = factor(Month_Name, levels = month.abb))
ggplot(df_monthly, aes(x = Month_Name, y = Monthly_Mean, color = Season, group = Season)) +
geom_point(size = 2.5) +
geom_line(linewidth = 1) +
facet_wrap(~ Variable, scales = "free_y", ncol = 2) +
labs(
x = "Month",
y = "Average Value",
color = "Season",
title = "Monthly Climatology of Climatic Variables (2014-2024)",
subtitle = "Average monthly values showing typical annual cycles"
) +
theme_minimal() +
theme(
plot.title = element_text(size = 14, face = "bold"),
plot.subtitle = element_text(size = 11),
strip.text = element_text(size = 10),
legend.position = "bottom",
axis.text.x = element_text(angle = 45, hjust = 1)
) +
scale_color_brewer(palette = "Set2")
results_viz2 <- results %>%
mutate(
Significance = if_else(p_value < 0.05, "Significant", "Not Significant"),
Z_abs = abs(Z)
)
ggplot(results_viz2, aes(x = reorder(paste(Season, Variable, sep = " - "), Z),
y = Z,
fill = Significance)) +
geom_bar(stat = "identity", alpha = 0.8) +
geom_hline(yintercept = c(-1.96, 0, 1.96),
linetype = c("dashed", "solid", "dashed"),
color = c("red", "black", "red"),
linewidth = 0.7) +
annotate("text", x = 1,
y = c(-1.96, 1.96),
label = c("Z = -1.96\n(α = 0.05)", "Z = 1.96\n(α = 0.05)"),
vjust = c(1.2, -0.2), hjust = 0, size = 3, color = "red") +
coord_flip() +
scale_fill_manual(values = c("Significant" = "#d62728",
"Not Significant" = "#95a5a6")) +
labs(
x = "Season - Variable",
y = "Z-Score",
fill = "Statistical Significance",
title = "Mann-Kendall Z-Scores by Season and Variable",
subtitle = "Horizontal dashed lines indicate critical values (±1.96) for α = 0.05"
) +
theme_minimal() +
theme(
plot.title = element_text(size = 14, face = "bold"),
plot.subtitle = element_text(size = 11),
axis.text.y = element_text(size = 8),
legend.position = "bottom"
)
ggplot(results_viz, aes(x = Season, y = Sen_slope, fill = Trend_Direction)) +
geom_bar(stat = "identity", alpha = 0.8, position = "dodge") +
geom_hline(yintercept = 0, linetype = "dashed", color = "black", linewidth = 0.5) +
facet_wrap(~ Variable, scales = "free_y", ncol = 2) +
scale_fill_manual(values = c("Increasing" = "#d62728",
"Decreasing" = "#2ca02c")) +
labs(
x = "Season",
y = "Sen's Slope (units/year)",
fill = "Trend Direction",
title = "Trend Magnitudes by Variable Across Seasons",
subtitle = "Positive values indicate increasing trends; negative values indicate decreasing trends"
) +
theme_minimal() +
theme(
plot.title = element_text(size = 14, face = "bold"),
plot.subtitle = element_text(size = 11),
strip.text = element_text(size = 10),
legend.position = "bottom",
axis.text.x = element_text(angle = 45, hjust = 1)
)
